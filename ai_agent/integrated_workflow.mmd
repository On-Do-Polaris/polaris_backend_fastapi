---
config:
  flowchart:
    curve: basis
---
graph TB;
    %% ===== ì¶”ê°€ ë°ì´í„° ì „ì²˜ë¦¬ =====
    subgraph PreProcess["ğŸ”§ ì¶”ê°€ ë°ì´í„° ì „ì²˜ë¦¬ (ì›Œí¬í”Œë¡œìš° ì™¸ë¶€)"]
        direction TB
        UserData[["ì‚¬ìš©ì ì…ë ¥<br/>(additional_data)"]]
        Helper["AdditionalDataHelper<br/>(LLM 1íšŒ í˜¸ì¶œ)"]
        Guidelines{{"ê°€ì´ë“œë¼ì¸ ìƒì„±<br/>(4ê°œ Agent)"}}

        UserData --> Helper
        Helper --> Guidelines
    end

    %% ===== ë©”ì¸ ì›Œí¬í”Œë¡œìš° =====
    subgraph MainFlow["ğŸš€ ë©”ì¸ ì›Œí¬í”Œë¡œìš° (LangGraph)"]
        direction TB

        Start(["__start__"])
        DC["1. Data Collection"]

        subgraph Parallel1["ë³‘ë ¬ ì‹¤í–‰ (ModelOps)"]
            PRS["2. Physical Risk Score<br/>(HÃ—EÃ—V)"]
            AAL["3. AAL Analysis<br/>(PÃ—D)"]
        end

        RI["4. Risk Integration"]

        subgraph Parallel2["Fork-Join ë³‘ë ¬"]
            BC["BC. Building Characteristics<br/>(LLM ì •ì„± ë¶„ì„)"]

            subgraph ReportChain["Report Chain"]
                RT["5. Report Template"]
                IA["6. Impact Analysis"]
                SG["7. Strategy Generation"]
                RG["8. Report Generation"]
            end
        end

        Val["9. Validation<br/>(Report + BC í†µí•© ê²€ì¦)"]
        Fin["10. Finalization"]
        End(["__end__"])

        Start --> DC
        DC --> PRS
        DC --> AAL
        PRS --> RI
        AAL --> RI
        RI --> BC
        RI --> RT
        RT --> IA
        IA --> SG
        SG --> RG
        BC --> Val
        RG --> Val
        Val -->|"í†µê³¼"| Fin
        Val -.->|"BC ì´ìŠˆ"| BC
        Val -.->|"Impact ì´ìŠˆ"| IA
        Val -.->|"Strategy ì´ìŠˆ"| SG
        Fin --> End
    end

    %% ===== ê°€ì´ë“œë¼ì¸ ì£¼ì… (ì ì„ ) =====
    Guidelines -.->|"ê°€ì´ë“œë¼ì¸ ì£¼ì…<br/>(relevance â‰¥ 0.4)"| BC
    Guidelines -.->|"ê°€ì´ë“œë¼ì¸ ì£¼ì…"| IA
    Guidelines -.->|"ê°€ì´ë“œë¼ì¸ ì£¼ì…"| SG
    Guidelines -.->|"ê°€ì´ë“œë¼ì¸ ì£¼ì…"| RG

    %% ìŠ¤íƒ€ì¼
    classDef preprocessing fill:#e1f5ff,stroke:#0288d1,stroke-width:3px
    classDef guideline fill:#fff9c4,stroke:#fbc02d,stroke-width:3px
    classDef main fill:#f2f0ff,stroke:#7c4dff,stroke-width:2px
    classDef parallel fill:#e8f5e9,stroke:#4caf50,stroke-width:2px

    class UserData,Helper preprocessing
    class Guidelines guideline
    class Start,DC,RI,Val,Fin,End main
    class PRS,AAL,BC,RT,IA,SG,RG parallel
