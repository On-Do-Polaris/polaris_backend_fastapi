<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1280">
  <!-- Title -->
  <text x="900" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#1a1a1a">
    SKAX Physical Risk Analysis - Fork-Join Parallel Architecture
  </text>

  <!-- Legend -->
  <g id="legend" transform="translate(50, 50)">
    <text x="0" y="0" font-size="14" font-weight="bold" fill="#333">Legend:</text>
    <rect x="0" y="10" width="20" height="20" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
    <text x="25" y="25" font-size="12" fill="#333">Pre-processing (독립 실행)</text>

    <rect x="220" y="10" width="20" height="20" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
    <text x="245" y="25" font-size="12" fill="#333">AI Agent Node</text>

    <rect x="400" y="10" width="20" height="20" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
    <text x="425" y="25" font-size="12" fill="#333">Super Agent</text>

    <rect x="580" y="10" width="20" height="20" fill="#e8f5e9" stroke="#388e3c" stroke-width="2"/>
    <text x="605" y="25" font-size="12" fill="#333">ModelOps 영역</text>

    <rect x="740" y="10" width="20" height="20" fill="#ffe0e0" stroke="#d32f2f" stroke-width="2"/>
    <text x="765" y="25" font-size="12" fill="#333">병합 노드</text>

    <circle cx="900" cy="20" r="8" fill="#4caf50" stroke="#2e7d32" stroke-width="1"/>
    <text x="905" y="18" font-size="8" font-weight="bold" text-anchor="middle" fill="#fff">G</text>
    <text x="915" y="25" font-size="12" fill="#333">Guideline 적용</text>
  </g>

  <!-- Pre-Processing Layer -->
  <g id="preprocessing">
    <rect x="50" y="120" width="1700" height="140" fill="#e3f2fd" stroke="#1976d2" stroke-width="3" stroke-dasharray="5,5" rx="10"/>
    <text x="900" y="145" font-size="16" font-weight="bold" text-anchor="middle" fill="#1565c0">
      Pre-Processing Layer (워크플로우 외부 독립 실행)
    </text>

    <rect x="250" y="165" width="300" height="80" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="400" y="190" font-size="14" font-weight="bold" text-anchor="middle" fill="#0d47a1">
      Additional Data Classifier
    </text>
    <text x="400" y="210" font-size="11" text-anchor="middle" fill="#1565c0">LLM 1회 호출 → 모든 Agent 가이드라인 생성</text>
    <text x="400" y="230" font-size="10" text-anchor="middle" fill="#1565c0" font-style="italic">
      (additional_data 있을 때만 실행)
    </text>

    <rect x="600" y="175" width="250" height="60" fill="#90caf9" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="725" y="195" font-size="12" font-weight="bold" text-anchor="middle" fill="#0d47a1">
      state['additional_data_guidelines']
    </text>
    <text x="725" y="215" font-size="10" text-anchor="middle" fill="#1565c0">
      각 Agent별 가이드라인
    </text>

    <path d="M 550 205 L 600 205" stroke="#1976d2" stroke-width="2" fill="none" marker-end="url(#arrowblue)"/>
  </g>

  <!-- Main Workflow -->
  <g id="workflow">
    <rect x="50" y="290" width="1700" height="880" fill="#fff8e1" stroke="#f57c00" stroke-width="3" rx="10"/>
    <text x="900" y="315" font-size="16" font-weight="bold" text-anchor="middle" fill="#e65100">
      LangGraph Workflow (11 Nodes - Fork-Join Pattern)
    </text>

    <!-- Node 1 -->
    <rect x="750" y="350" width="300" height="70" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="900" y="375" font-size="14" font-weight="bold" text-anchor="middle">Node 1: Data Collection</text>
    <text x="900" y="395" font-size="11" text-anchor="middle" fill="#555">기후 데이터 수집</text>
    <text x="900" y="410" font-size="9" text-anchor="middle" fill="#777">climate_data_collector</text>

    <!-- ModelOps Area -->
    <rect x="500" y="450" width="800" height="200" fill="#e8f5e9" stroke="#388e3c" stroke-width="3" rx="8"/>
    <text x="900" y="475" font-size="15" font-weight="bold" text-anchor="middle" fill="#2e7d32">
      ModelOps 연산 영역 (Node 3, 4 병렬 실행)
    </text>

    <!-- Node 3 & 4 -->
    <rect x="550" y="500" width="300" height="130" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
    <text x="700" y="525" font-size="13" font-weight="bold" text-anchor="middle" fill="#4a148c">Node 3: Physical Risk</text>
    <text x="700" y="545" font-size="11" text-anchor="middle" fill="#555">Super Agent (9개)</text>
    <text x="700" y="563" font-size="10" text-anchor="middle" fill="#2e7d32">→ ModelOps: H×E×V</text>

    <rect x="950" y="500" width="300" height="130" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
    <text x="1100" y="525" font-size="13" font-weight="bold" text-anchor="middle" fill="#4a148c">Node 4: AAL Analysis</text>
    <text x="1100" y="545" font-size="11" text-anchor="middle" fill="#555">Super Agent (9개)</text>
    <text x="1100" y="563" font-size="10" text-anchor="middle" fill="#2e7d32">→ ModelOps: 확률×손상률</text>

    <!-- Node 5 -->
    <rect x="750" y="680" width="300" height="70" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="900" y="705" font-size="14" font-weight="bold" text-anchor="middle">Node 5: Integration</text>
    <text x="900" y="725" font-size="11" text-anchor="middle" fill="#555">리스크 통합 분석</text>
    <text x="900" y="740" font-size="9" text-anchor="middle" fill="#777">risk_integrator</text>

    <!-- Fork Indicator -->
    <text x="900" y="780" font-size="14" font-weight="bold" text-anchor="middle" fill="#d84315">
      ⚡ Fork: 병렬 분기
    </text>

    <!-- Left Branch: Node 2 -->
    <g id="left-branch">
      <rect x="200" y="820" width="400" height="200" fill="#e1f5fe" stroke="#0288d1" stroke-width="2" stroke-dasharray="5,5" rx="8"/>
      <text x="400" y="845" font-size="13" font-weight="bold" text-anchor="middle" fill="#01579b">
        브랜치  1
      </text>

      <rect x="250" y="870" width="300" height="120" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
      <text x="400" y="895" font-size="14" font-weight="bold" text-anchor="middle">Node 2: Building</text>
      <text x="400" y="913" font-size="14" font-weight="bold" text-anchor="middle">Characteristics</text>
      <text x="400" y="935" font-size="11" text-anchor="middle" fill="#555">건물 특징 분석</text>
      <text x="400" y="953" font-size="10" text-anchor="middle" fill="#777">Score/AAL 결과 해석</text>
      <text x="400" y="968" font-size="9" text-anchor="middle" fill="#999">LLM 기반 정성 분석</text>

      <circle cx="530" cy="930" r="10" fill="#4caf50" stroke="#2e7d32" stroke-width="1.5"/>
      <text x="530" y="934" font-size="9" font-weight="bold" text-anchor="middle" fill="#fff">G</text>
    </g>

    <!-- Right Branch: Report Chain -->
    <g id="right-branch">
      <rect x="700" y="820" width="1000" height="200" fill="#fff3e0" stroke="#f57c00" stroke-width="2" stroke-dasharray="5,5" rx="8"/>
      <text x="1200" y="845" font-size="13" font-weight="bold" text-anchor="middle" fill="#e65100">
        브랜치 2: 리포트 체인 (순차 실행)
      </text>

      <!-- Node 6 -->
      <rect x="750" y="870" width="200" height="60" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
      <text x="850" y="895" font-size="13" font-weight="bold" text-anchor="middle">Node 6:</text>
      <text x="850" y="913" font-size="13" font-weight="bold" text-anchor="middle">Template</text>
      <circle cx="930" cy="900" r="8" fill="#4caf50" stroke="#2e7d32" stroke-width="1"/>
      <text x="930" y="903" font-size="8" font-weight="bold" text-anchor="middle" fill="#fff">G</text>

      <!-- Node 7 -->
      <rect x="1000" y="870" width="200" height="60" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
      <text x="1100" y="895" font-size="13" font-weight="bold" text-anchor="middle">Node 7:</text>
      <text x="1100" y="913" font-size="13" font-weight="bold" text-anchor="middle">Impact</text>
      <circle cx="1180" cy="900" r="8" fill="#4caf50" stroke="#2e7d32" stroke-width="1"/>
      <text x="1180" y="903" font-size="8" font-weight="bold" text-anchor="middle" fill="#fff">G</text>

      <!-- Node 8 -->
      <rect x="1250" y="870" width="200" height="60" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
      <text x="1350" y="895" font-size="13" font-weight="bold" text-anchor="middle">Node 8:</text>
      <text x="1350" y="913" font-size="13" font-weight="bold" text-anchor="middle">Strategy</text>
      <circle cx="1430" cy="900" r="8" fill="#4caf50" stroke="#2e7d32" stroke-width="1"/>
      <text x="1430" y="903" font-size="8" font-weight="bold" text-anchor="middle" fill="#fff">G</text>

      <!-- Node 9 -->
      <rect x="750" y="950" width="200" height="60" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
      <text x="850" y="975" font-size="13" font-weight="bold" text-anchor="middle">Node 9:</text>
      <text x="850" y="993" font-size="13" font-weight="bold" text-anchor="middle">Report</text>
      <circle cx="930" cy="980" r="8" fill="#4caf50" stroke="#2e7d32" stroke-width="1"/>
      <text x="930" y="983" font-size="8" font-weight="bold" text-anchor="middle" fill="#fff">G</text>

      <!-- Sequential arrows -->
      <path d="M 950 900 L 1000 900" stroke="#f57c00" stroke-width="2" fill="none" marker-end="url(#arroworange)"/>
      <path d="M 1200 900 L 1250 900" stroke="#f57c00" stroke-width="2" fill="none" marker-end="url(#arroworange)"/>
      <path d="M 1350 930 L 1350 945 L 850 945 L 850 950" stroke="#f57c00" stroke-width="2" fill="none" marker-end="url(#arroworange)"/>
    </g>

    <!-- Join Indicator -->
    <text x="900" y="1050" font-size="14" font-weight="bold" text-anchor="middle" fill="#d84315">
      ⚡ Join: 병합
    </text>

    <!-- Node 10: Merge Node -->
    <rect x="650" y="1070" width="500" height="70" fill="#ffcccc" stroke="#d32f2f" stroke-width="3" rx="5"/>
    <text x="900" y="1095" font-size="14" font-weight="bold" text-anchor="middle" fill="#b71c1c">
      Node 10: Validation (병합 노드)
    </text>
    <text x="900" y="1115" font-size="11" text-anchor="middle" fill="#c62828">
      브랜치 1, 2 결과 통합 검증
    </text>
    <text x="900" y="1130" font-size="9" text-anchor="middle" fill="#e53935">
      validator (Building Characteristics 포함)
    </text>

    <!-- Node 11 -->
    <rect x="750" y="1160" width="300" height="60" fill="#c8e6c9" stroke="#388e3c" stroke-width="3" rx="5"/>
    <text x="900" y="1185" font-size="14" font-weight="bold" text-anchor="middle" fill="#2e7d32">
      Node 11: Finalization
    </text>
    <text x="900" y="1208" font-size="11" text-anchor="middle" fill="#1b5e20">
      최종 리포트 확정 및 반환
    </text>
  </g>

  <!-- Arrows -->
  <defs>
    <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#1976d2"/>
    </marker>
    <marker id="arroworange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#f57c00"/>
    </marker>
    <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#4caf50"/>
    </marker>
  </defs>

  <!-- Pre-processing to Workflow -->
  <path d="M 725 260 L 725 290" stroke="#1976d2" stroke-width="3" fill="none" marker-end="url(#arrowblue)" stroke-dasharray="5,5"/>

  <!-- 1 → 3, 4 -->
  <path d="M 900 420 L 700 500" stroke="#f57c00" stroke-width="3" fill="none" marker-end="url(#arroworange)"/>
  <path d="M 900 420 L 1100 500" stroke="#f57c00" stroke-width="3" fill="none" marker-end="url(#arroworange)"/>

  <!-- 3, 4 → 5 -->
  <path d="M 700 630 L 900 680" stroke="#f57c00" stroke-width="3" fill="none" marker-end="url(#arroworange)"/>
  <path d="M 1100 630 L 900 680" stroke="#f57c00" stroke-width="3" fill="none" marker-end="url(#arroworange)"/>

  <!-- 5 → Fork (2 and 6) -->
  <path d="M 900 750 L 400 870" stroke="#f57c00" stroke-width="3" fill="none" marker-end="url(#arroworange)"/>
  <path d="M 900 750 L 850 870" stroke="#f57c00" stroke-width="3" fill="none" marker-end="url(#arroworange)"/>

  <!-- Join (2 and 9) → 10 -->
  <path d="M 400 990 L 650 1105" stroke="#f57c00" stroke-width="3" fill="none" marker-end="url(#arroworange)"/>
  <path d="M 950 980 L 1150 1105" stroke="#f57c00" stroke-width="3" fill="none" marker-end="url(#arroworange)"/>

  <!-- 10 → 11 -->
  <path d="M 900 1140 L 900 1180" stroke="#f57c00" stroke-width="3" fill="none" marker-end="url(#arroworange)"/>

  <!-- Guideline access -->
  <path d="M 725 290 L 725 320 L 540 320 L 540 920" stroke="#4caf50" stroke-width="1.5" fill="none" marker-end="url(#arrowgreen)" stroke-dasharray="3,3"/>
  <path d="M 725 290 L 725 320 L 940 320 L 940 892" stroke="#4caf50" stroke-width="1.5" fill="none" marker-end="url(#arrowgreen)" stroke-dasharray="3,3"/>
  <path d="M 725 290 L 725 320 L 1190 320 L 1190 892" stroke="#4caf50" stroke-width="1.5" fill="none" marker-end="url(#arrowgreen)" stroke-dasharray="3,3"/>
  <path d="M 725 290 L 725 320 L 1440 320 L 1440 892" stroke="#4caf50" stroke-width="1.5" fill="none" marker-end="url(#arrowgreen)" stroke-dasharray="3,3"/>
  <path d="M 725 290 L 725 320 L 940 320 L 940 972" stroke="#4caf50" stroke-width="1.5" fill="none" marker-end="url(#arrowgreen)" stroke-dasharray="3,3"/>

  <!-- Bottom Summary -->
  <text x="900" y="1268" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">
    실행 순서: 1 → (3 ∥ 4) → 5 → Fork(2 ∥ [6→7→8→9]) → Join(10) → 11 → END
  </text>
</svg>